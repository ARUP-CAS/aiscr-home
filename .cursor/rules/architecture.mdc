---
alwaysApply: true
---
# Architektura aplikace AIS CR

Tento dokument popisuje obecnÃ© principy, architektonickÃ© rozhodnutÃ­ a konvence pouÅ¾Ã­vanÃ© v tÃ©to aplikaci.

## ğŸ“š Obsah

1. [TechnologickÃ½ stack](#technologickÃ½-stack)
2. [Struktura projektu](#struktura-projektu)
3. [Svelte 5 Runes](#svelte-5-runes)
4. [Komponenty a prop drilling](#komponenty-a-prop-drilling)
5. [Styling s Tailwind CSS 4.0](#styling-s-tailwind-css-40)
6. [Internacionalizace (i18n)](#internacionalizace-i18n)
7. [Routing a prerenderovÃ¡nÃ­](#routing-a-prerenderovÃ¡nÃ­)
8. [Markdown obsah](#markdown-obsah)
9. [Konvence a best practices](#konvence-a-best-practices)
10. [Deployment](#deployment)

---

## TechnologickÃ½ stack

### Core technologie
- **SvelteKit 2.x** - Full-stack framework pro Svelte
- **Svelte 5** - UI framework s novÃ½mi runes API
- **TypeScript** - Type-safe JavaScript
- **Vite 7** - Build tool a dev server
- **pnpm** - RychlÃ½ package manager

### Styling
- **Tailwind CSS 4.0** - Utility-first CSS framework
- **@tailwindcss/forms** - FormulÃ¡Å™ovÃ© styly
- **@tailwindcss/typography** - TypografickÃ© styly pro markdown
- **Scoped CSS** - VlastnÃ­ styly v `<style>` blocÃ­ch komponent

### DalÅ¡Ã­ nÃ¡stroje
- **Paraglide JS** - i18n Å™eÅ¡enÃ­ pro vÃ­cejazyÄnost (cs/en)
- **MDSvex** - Markdown preprocessor pro Svelte
- **Lucide Svelte** - Ikony
- **ESLint + Prettier** - Code linting a formÃ¡tovÃ¡nÃ­

---

## Struktura projektu

```
aiscr-home/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ components/          # Svelte komponenty
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.svelte
â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.svelte
â”‚   â”‚   â”‚   â”œâ”€â”€ Hero.svelte
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ assets/              # Assets (SVG, ikony)
â”‚   â”‚   â””â”€â”€ paraglide/           # GenerovanÃ© i18n soubory
â”‚   â”œâ”€â”€ routes/                  # SvelteKit routing
â”‚   â”‚   â”œâ”€â”€ +layout.svelte       # Root layout
â”‚   â”‚   â”œâ”€â”€ +layout.ts           # Root layout load
â”‚   â”‚   â”œâ”€â”€ +page.svelte         # Homepage
â”‚   â”‚   â””â”€â”€ blog/                # Blog routes
â”‚   â”‚       â”œâ”€â”€ +page.server.ts  # Server-side naÄÃ­tÃ¡nÃ­ dat
â”‚   â”‚       â”œâ”€â”€ +page.svelte     # Blog listing
â”‚   â”‚       â””â”€â”€ [slug]/          # DynamickÃ© blog strÃ¡nky
â”‚   â”œâ”€â”€ content/                 # Markdown obsah
â”‚   â”‚   â””â”€â”€ blog/
â”‚   â”‚       â”œâ”€â”€ *.md             # ÄŒeskÃ© ÄlÃ¡nky
â”‚   â”‚       â””â”€â”€ *.en.md          # AnglickÃ© ÄlÃ¡nky
â”‚   â”œâ”€â”€ app.css                  # GlobÃ¡lnÃ­ Tailwind import
â”‚   â”œâ”€â”€ app.html                 # HTML template
â”‚   â”œâ”€â”€ hooks.server.ts          # Server hooks (i18n middleware)
â”‚   â””â”€â”€ hooks.ts                 # Client hooks (rerouting)
â”œâ”€â”€ static/                      # StatickÃ© soubory (obrÃ¡zky, fonts)
â”‚   â””â”€â”€ images/
â”œâ”€â”€ messages/                    # i18n pÅ™eklady
â”‚   â”œâ”€â”€ cs.json
â”‚   â””â”€â”€ en.json
â”œâ”€â”€ project.inlang/              # Inlang konfigurace
â””â”€â”€ build/                       # Output statickÃ©ho buildu
```

### Principy organizace

1. **Komponenty v `src/lib/components/`** - VÅ¡echny znovupouÅ¾itelnÃ© UI komponenty
2. **Routes v `src/routes/`** - File-based routing dle SvelteKit konvencÃ­
3. **Obsah v `src/content/`** - Markdown soubory (blog ÄlÃ¡nky)
4. **StatickÃ© soubory v `static/`** - ObrÃ¡zky, fonty, robots.txt
5. **PÅ™eklady v `messages/`** - JSON soubory pro i18n

---

## Svelte 5 Runes

Tento projekt pouÅ¾Ã­vÃ¡ **Svelte 5** s novÃ½m **runes API**. Runes jsou novÃ½ zpÅ¯sob prÃ¡ce s reaktivitou v Svelte.


## Komponenty a prop drilling

### Pure components

Projekt pouÅ¾Ã­vÃ¡ **pure components** - komponenty jsou ÄistÃ© funkce svÃ½ch props bez globÃ¡lnÃ­ho stavu.

**VÃ½hody:**
- âœ… PÅ™edvÃ­datelnÃ© chovÃ¡nÃ­
- âœ… SnadnÃ© testovÃ¡nÃ­
- âœ… ExplicitnÃ­ datovÃ½ tok
- âœ… Å½Ã¡dnÃ© skrytÃ© zÃ¡vislosti

### Prop drilling pattern

Data se pÅ™edÃ¡vajÃ­ explicitnÄ› skrze props z rodiÄovskÃ© komponenty do potomkÅ¯.

**PÅ™Ã­klad z projektu:**

```svelte
<!-- routes/+page.svelte - Parent -->
<script lang="ts">
  import Hero from '$lib/components/Hero.svelte';
  import Features from '$lib/components/Features.svelte';
  import Services from '$lib/components/Services.svelte';
</script>

<Hero />
<Features />
<Services />
```

Komponenty jsou **autonomnÃ­** - zÃ­skÃ¡vajÃ­ data buÄ:
1. Z props (kdyÅ¾ data pÅ™ichÃ¡zejÃ­ z rodiÄe)
2. Z i18n (pÅ™eklady)
3. Z vlastnÃ­ho naÄtenÃ­ (napÅ™. BlogPreview naÄÃ­tÃ¡ markdown soubory)

### Server load functions

Pro server-side data loading se pouÅ¾Ã­vajÃ­ `+page.server.ts` soubory:

```typescript
// routes/blog/+page.server.ts
export const load: PageServerLoad = async () => {
  const locale = getLocale();
  const allModules = import.meta.glob('/src/content/blog/*.md', { eager: true });
  
  const posts = Object.entries(allModules)
    .map(([path, module]) => {
      const { metadata } = module as any;
      return {
        slug: metadata.slug,
        title: metadata.title,
        // ...
      };
    })
    .filter(post => post.published && post.locale === locale);
  
  return { posts };
};
```

Data jsou pak dostupnÃ¡ v komponentÄ› pÅ™es `$props()`:

```svelte
<script lang="ts">
  let { data }: { data: PageData } = $props();
</script>

{#each data.posts as post}
  <!-- ... -->
{/each}
```

### Kompozice komponent

Komponenty jsou **jednoÃºÄelovÃ© a znovupouÅ¾itelnÃ©**:

```svelte
<!-- +layout.svelte -->
<div class="min-h-screen flex flex-col">
  <Header />
  <main class="flex-1">
    {@render children?.()}
  </main>
  <Footer />
</div>
```

**Render props pattern** - pouÅ¾itÃ­ `{@render children?.()}` pro vnoÅ™enÃ½ obsah.

---

## Styling s Tailwind CSS 4.0

Projekt pouÅ¾Ã­vÃ¡ **Tailwind CSS 4.0** - nejnovÄ›jÅ¡Ã­ verzi s Vite pluginem.

### Import a konfigurace

```css
/* src/app.css */
@import 'tailwindcss';
@plugin '@tailwindcss/forms';
@plugin '@tailwindcss/typography';

body {
  font-family: 'Roboto', sans-serif;
}
```

**Vite konfigurace:**

```typescript
// vite.config.ts
import tailwindcss from '@tailwindcss/vite';

export default defineConfig({
  plugins: [
    tailwindcss(),
    sveltekit(),
    // ...
  ]
});
```

### Styling pÅ™Ã­stup

Projekt mÃ¡ pouze **jeden pÅ™Ã­stup**:

#### 1. Utility-first Tailwind classes

```svelte
<div class="flex items-center justify-between">
  <nav class="flex items-center space-x-8">
    <a href="/" class="text-white hover:text-gray-300 transition-colors">
      Link
    </a>
  </nav>
</div>
```

### Responzivita

Tailwind responsive breakpoints:

```svelte
<div class="px-4 sm:px-6 lg:px-8">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Responsive grid -->
  </div>
</div>
```

### Design systÃ©m

**Barvy:**
- Primary red: `#C6362E`
- Dark red: `#721C17` (rgba(114, 28, 23, 0.8))
- Purple: `rgba(128, 35, 118, 0.8)`
- Gray: `#808E98`, `rgba(128, 142, 152, 0.8)`
- Orange: `rgba(219, 145, 52, 0.8)`

**Fonty:**
- Body: `'Roboto', sans-serif`
- Headings: `'Roboto Slab', serif`

**Spacing:**
- Max container width: `1312px`
- Section padding: `128px 0 80px 0` (top, bottom)
- Standard gaps: `16px`, `24px`, `32px`

---

## Internacionalizace (i18n)

Projekt pouÅ¾Ã­vÃ¡ **Paraglide JS** - modernÃ­ i18n Å™eÅ¡enÃ­ s compile-time pÅ™eklady.

### Konfigurace

```json
// project.inlang/settings.json
{
  "baseLocale": "cs",
  "locales": ["cs", "en"]
}
```

### PÅ™eklady

```json
// messages/cs.json
{
  "hero.title": "ArcheologickÃ½ informaÄnÃ­ systÃ©m ÄŒeskÃ© republiky",
  "hero.subtitle": "DigitÃ¡lnÃ­ brÃ¡na do svÄ›ta ÄeskÃ© archeologie",
  "nav.services": "SluÅ¾by"
}

// messages/en.json
{
  "hero.title": "Archaeological Information System of the Czech Republic",
  "hero.subtitle": "Digital gateway to Czech archaeology",
  "nav.services": "Services"
}
```

### PouÅ¾itÃ­ v komponentÃ¡ch

```svelte
<script lang="ts">
  import { m } from '$lib/paraglide/messages.js';
  import { getLocale, setLocale } from '$lib/paraglide/runtime';
</script>

<!-- JednoduchÃ½ pÅ™eklad -->
<h1>{m['hero.title']()}</h1>

<!-- HTML pÅ™eklad -->
<p>{@html m['hero.description']()}</p>

<!-- DynamickÃ© klÃ­Äe -->
{#each features as feature}
  <p>{(m as any)[`features.${feature.key}.description`]()}</p>
{/each}

<!-- PÅ™epÃ­nÃ¡nÃ­ jazyka -->
<button onclick={() => setLocale(getLocale() === 'cs' ? 'en' : 'cs')}>
  {getLocale()}
</button>
```

### Server-side i18n

```typescript
// hooks.server.ts
import { paraglideMiddleware } from '$lib/paraglide/server';

export const handle: Handle = ({ event, resolve }) =>
  paraglideMiddleware(event.request, ({ request, locale }) => {
    event.request = request;
    return resolve(event, {
      transformPageChunk: ({ html }) => html.replace('%paraglide.lang%', locale)
    });
  });
```

### Rerouting

```typescript
// hooks.ts
import { deLocalizeUrl } from '$lib/paraglide/runtime';

export const reroute = (request) => deLocalizeUrl(request.url).pathname;
```

UmoÅ¾Åˆuje URL jako `/en/blog` -> smÄ›ruje na `/blog` s locale nastavenÃ­m.

---

## Routing a prerenderovÃ¡nÃ­

### File-based routing

SvelteKit pouÅ¾Ã­vÃ¡ file-system based routing:

```
routes/
â”œâ”€â”€ +layout.svelte          â†’ Layout pro vÅ¡echny strÃ¡nky
â”œâ”€â”€ +layout.ts             â†’ prerender = true
â”œâ”€â”€ +page.svelte           â†’ / (homepage)
â””â”€â”€ blog/
    â”œâ”€â”€ +layout.svelte     â†’ Layout pro blog sekci
    â”œâ”€â”€ +page.server.ts    â†’ Server load (seznam ÄlÃ¡nkÅ¯)
    â”œâ”€â”€ +page.svelte       â†’ /blog (listing)
    â””â”€â”€ [slug]/
        â”œâ”€â”€ +page.ts       â†’ Client load (konkrÃ©tnÃ­ ÄlÃ¡nek)
        â””â”€â”€ +page.svelte   â†’ /blog/[slug]
```

### PrerenderovÃ¡nÃ­

```typescript
// routes/+layout.ts
export const prerender = true;
```

**VÅ¡echny strÃ¡nky jsou prerendrovÃ¡ny** bÄ›hem buildu â†’ statickÃ½ web.

### Static adapter

```javascript
// svelte.config.js
import adapter from '@sveltejs/adapter-static';

const config = {
  kit: {
    adapter: adapter({
      pages: 'build',
      assets: 'build',
      fallback: '404.html',
      strict: true
    })
  }
};
```

Generuje statickÃ© HTML soubory do sloÅ¾ky `build/`.

---

## Markdown obsah

### MDSvex konfigurace

```javascript
// svelte.config.js
import { mdsvex } from 'mdsvex';

const config = {
  preprocess: [
    vitePreprocess(), 
    mdsvex({
      extensions: ['.md', '.svx']
    })
  ],
  extensions: ['.svelte', '.svx', '.md']
};
```

### Struktura ÄlÃ¡nkÅ¯

```
src/content/blog/
â”œâ”€â”€ digitalizace-sbirek.md        # ÄŒeskÃ½ ÄlÃ¡nek
â”œâ”€â”€ digitalizace-sbirek.en.md     # AnglickÃ½ pÅ™eklad
â”œâ”€â”€ nove-objevy-doba-bronzova.md
â””â”€â”€ nove-objevy-doba-bronzova.en.md
```

### Frontmatter metadata

```markdown
---
slug: digitalizace-sbirek
title: Digitalizace sbÃ­rek
excerpt: KrÃ¡tkÃ½ popis ÄlÃ¡nku...
date: 2024-01-15
category: Technologie
published: true
locale: cs
author: AIS CR Team
authorRole: VÃ½zkumnÃ½ tÃ½m
authorImage: /images/people/ais-staff.png
image: /images/blog/placeholder.png
readingTime: 5 minut
---

# Obsah ÄlÃ¡nku

Text ÄlÃ¡nku v markdown formÃ¡tu...
```

### NaÄÃ­tÃ¡nÃ­ ÄlÃ¡nkÅ¯

```typescript
// GlobÃ¡lnÃ­ import vÅ¡ech markdown souborÅ¯
const allModules = import.meta.glob('/src/content/blog/*.md', { eager: true });

const posts = Object.entries(allModules)
  .map(([path, module]) => {
    const { metadata } = module as any;
    return {
      slug: metadata.slug,
      title: metadata.title,
      // ...
    };
  })
  .filter(post => post.published && post.locale === locale);
```

---

## Konvence a best practices

### TypeScript

- **Strict mode** zapnutÃ½ v `tsconfig.json`
- Type vÅ¡ech props a funkcÃ­
- Avoid `any` kde je moÅ¾nÃ©, use type guards

```typescript
let { data }: { data: PageData } = $props();
let blogPosts = $state<any[]>([]);  // TODO: type BlogPost

function formatDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString('cs-CZ', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
```

### Komponenty

1. **Single Responsibility** - kaÅ¾dÃ¡ komponenta mÃ¡ jeden ÃºÄel
2. **AutonomnÃ­** - komponenta mÃ¡ vÅ¡e potÅ™ebnÃ© v sobÄ›
3. **Prop drilling** - explicitnÃ­ pÅ™edÃ¡vÃ¡nÃ­ dat
4. **Pure** - Å¾Ã¡dnÃ½ globÃ¡lnÃ­ stav (kromÄ› i18n)

```svelte
<!-- âœ… DobrÃ½ pÅ™Ã­klad -->
<script lang="ts">
  import { m } from '$lib/paraglide/messages.js';
  
  let isOpen = $state(false);
  
  function toggle() {
    isOpen = !isOpen;
  }
</script>

<button onclick={toggle}>
  {m['button.text']()}
</button>

{#if isOpen}
  <div>Content</div>
{/if}
```

#### Anti-patterns

```svelte
<script lang="ts">
  let count = $state(0);
  
  // âŒ Å PATNÄš - nekoneÄnÃ¡ smyÄka
  $effect(() => {
    count++; // ZmÄ›na stavu v effectu kterÃ½ sleduje tento stav
  });
  
  // âœ… SPRÃVNÄš - guard condition
  $effect(() => {
    if (count < 10) {
      count++;
    }
  });
  
  // âŒ Å PATNÄš - async v derived
  let data = $derived(await fetchData()); // Nelze pouÅ¾Ã­t await
  
  // âœ… SPRÃVNÄš - async v effect
  let data = $state(null);
  $effect(() => {
    fetchData().then(result => {
      data = result;
    });
  });
  
  // âŒ Å PATNÄš - mutace props
  let { items } = $props();
  items.push('new'); // Nelze mÄ›nit props
  
  // âœ… SPRÃVNÄš - pouÅ¾Ã­t $bindable nebo callback
  let { items, onAddItem } = $props();
  onAddItem('new'); // Volat callback do parent
</script>
```

### Accessibility

- **ARIA labels** pro ikony a interaktivnÃ­ prvky
- **Semantic HTML** (nav, main, section, article, footer)
- **Alt text** pro obrÃ¡zky
- **Focus states** pro klavesovou navigaci

```svelte
<button 
  aria-label={m['aria.openMenu']()} 
  onclick={toggleMenu}
>
  <Menu size="24" />
</button>

<a 
  href="https://facebook.com" 
  target="_blank" 
  rel="noopener noreferrer"
  aria-label={m['aria.facebook']()}
>
  <Facebook size="20" />
</a>
```

### Performance

1. **Image optimization** - webp formÃ¡ty, sprÃ¡vnÃ© velikosti
2. **Lazy loading** - `loading="lazy"` pro obrÃ¡zky mimo viewport
3. **Passive event listeners** - `{ passive: true }` pro scroll handlers
4. **Code splitting** - automatickÃ© dÃ­ky SvelteKit


### ESLint a Prettier

```javascript
// eslint.config.js
export default defineConfig(
  js.configs.recommended,
  ...ts.configs.recommended,
  ...svelte.configs.recommended,
  prettier,
  ...svelte.configs.prettier
);
```

**FormÃ¡tovÃ¡nÃ­:**
```bash
pnpm format        # FormÃ¡tovat vÅ¡echny soubory
pnpm lint          # Zkontrolovat code style
```

---

## Deployment

### Build proces

```bash
# VÃ½voj
pnpm dev

# Type-checking
pnpm check

# Production build
pnpm build
```

### Static build output

Build vytvoÅ™Ã­ statickou aplikaci ve sloÅ¾ce `build/`:

```
build/
â”œâ”€â”€ _app/                    # App assets
â”‚   â”œâ”€â”€ immutable/          # Versioned assets
â”‚   â”‚   â”œâ”€â”€ assets/         # CSS
â”‚   â”‚   â”œâ”€â”€ chunks/         # JS chunks
â”‚   â”‚   â””â”€â”€ entry/          # Entry points
â”‚   â””â”€â”€ version.json
â”œâ”€â”€ index.html              # Homepage
â”œâ”€â”€ blog/                   # Blog pages
â”‚   â”œâ”€â”€ __data.json
â”‚   â””â”€â”€ *.html
â”œâ”€â”€ blog.html
â”œâ”€â”€ images/                 # StatickÃ© obrÃ¡zky
â””â”€â”€ robots.txt
```

### Adapter konfigurace

```javascript
// svelte.config.js
adapter: adapter({
  pages: 'build',
  assets: 'build',
  fallback: '404.html',      // 404 strÃ¡nka
  precompress: false,        // Gzip/Brotli komprese
  strict: true               // HlÃ¡sit chyby pÅ™i buildu
})
```

### Preview

```bash
pnpm preview  # NÃ¡hled production buildu lokÃ¡lnÄ›
```

### Deployment targets

StatickÃ½ build lze nasadit na:
- **Netlify**
- **Vercel**
- **GitHub Pages**
- **Cloudflare Pages**
- **AWS S3 + CloudFront**
- JakÃ½koliv statickÃ½ hosting

---

## ShrnutÃ­ klÃ­ÄovÃ½ch principÅ¯

### âœ… Co POUÅ½ÃT

#### Svelte 5 Runes
1. **`$state`** - pro reaktivnÃ­ stav
2. **`$derived`** - pro computed values mÃ­sto funkcÃ­
3. **`$props`** - pro props komponent
4. **`$effect`** - pro reaktivnÃ­ side effects
7. **`$bindable`** - pro two-way binding

#### Architektura
8. **Pure components** - bez globÃ¡lnÃ­ho stavu
9. **Prop drilling** - explicitnÃ­ data flow
10. **TypeScript** - type safety vÅ¡ude
11. **Semantic HTML** - accessibility

#### Styling
12. **Tailwind utility classes** - rychlÃ½ vÃ½voj

#### Best Practices
13. **Paraglide i18n** - compile-time pÅ™eklady
14. **PrerenderovÃ¡nÃ­** - statickÃ½ output
15. **Lazy loading** - pro obrÃ¡zky
16. **ARIA labels** - pro accessibility

### ğŸ“‹ Checklist novÃ© komponenty

PÅ™i vytvÃ¡Å™enÃ­ novÃ© komponenty zkontrolovat:

- [ ] PouÅ¾Ã­vÃ¡ `$state` mÃ­sto `let` pro reaktivnÃ­ stav?
- [ ] PouÅ¾Ã­vÃ¡ `$props()` pro props?
- [ ] PouÅ¾Ã­vÃ¡ `$derived` pro computed values?
- [ ] MÃ¡ sprÃ¡vnÃ© TypeScript typy?
- [ ] MÃ¡ ARIA labels pro interaktivnÃ­ elementy?
- [ ] PouÅ¾Ã­vÃ¡ i18n pro texty (`m['key']()`)?
- [ ] MÃ¡ responsive design (Tailwind breakpoints)?
- [ ] MÃ¡ cleanup v `$effect`?
- [ ] Neobsahuje `$inspect` v produkÄnÃ­m kÃ³du?
